<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-security/cis_self_assessment123">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<title data-rh="true">CIS 1.23 Self-Assessment Guide | RKE 2</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.rke2.io/security/cis_self_assessment123"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CIS 1.23 Self-Assessment Guide | RKE 2"><meta data-rh="true" name="description" content="CIS Kubernetes Benchmark v1.23 - RKE2"><meta data-rh="true" property="og:description" content="CIS Kubernetes Benchmark v1.23 - RKE2"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.rke2.io/security/cis_self_assessment123"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/security/cis_self_assessment123" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/security/cis_self_assessment123" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.de3a1a77.css">
<link rel="preload" href="/assets/js/runtime~main.a04d5984.js" as="script">
<link rel="preload" href="/assets/js/main.f0033ba0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-horizontal-rke2.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-horizontal-rke2-dark.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/rancher/rke2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn icon-github">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/install/quickstart">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/upgrade">Upgrades</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/security/about_hardened_images">Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/about_hardened_images">About Hardened Images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/hardening_guide">CIS Hardening Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/cis_self_assessment16">CIS 1.6 Self-Assessment Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/security/cis_self_assessment123">CIS 1.23 Self-Assessment Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/fips_support">FIPS 140-2 Enablement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/pod_security_policies">Default Policy Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/pod_security_standards">Default Pod Security Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/selinux">SELinux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security/secrets_encryption">Secrets Encryption</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cluster_access">Cluster Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/backup_restore">Etcd Backup and Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/networking">Networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/helm">Helm Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/advanced">Advanced Options and Configuration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/linux_agent_config">Reference</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/known_issues">Known Issues and Limits</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Security</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CIS 1.23 Self-Assessment Guide</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CIS 1.23 Self-Assessment Guide</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cis-kubernetes-benchmark-v123---rke2">CIS Kubernetes Benchmark v1.23 - RKE2<a class="hash-link" href="#cis-kubernetes-benchmark-v123---rke2" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h4><p>This document is a companion to the RKE2 security hardening guide. The hardening guide provides prescriptive guidance for hardening a production installation of RKE2, and this benchmark guide is meant to help you evaluate the level of security of the hardened cluster against each control in the CIS Kubernetes benchmark. It is to be used by RKE2 operators, security teams, auditors, and decision makers.</p><p>This guide is specific to the <strong>v1.25</strong> release line of RKE2 and the <strong>v1.23</strong> release of the CIS Kubernetes Benchmark.</p><p>For more details about each control, including detailed descriptions and remediations for failing tests, you can refer to the corresponding section of the CIS Kubernetes Benchmark v1.23 You can download the benchmark after logging in to <a href="https://www.cisecurity.org/benchmark/kubernetes/" target="_blank" rel="noopener noreferrer">CISecurity.org</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-controls-methodology">Testing controls methodology<a class="hash-link" href="#testing-controls-methodology" title="Direct link to heading">​</a></h4><p>Each control in the CIS Kubernetes Benchmark was evaluated against an RKE2 cluster that was configured according to the accompanying hardening guide.</p><p>Where control audits differ from the original CIS benchmark, the audit commands specific to RKE2 are provided for testing.</p><p>These are the possible results for each control:</p><ul><li><strong>Pass</strong> - The RKE2 cluster under test passed the audit outlined in the benchmark.</li><li><strong>Not Applicable</strong> - The control is not applicable to RKE2 because of how it is designed to operate. The remediation section will explain why this is so.</li><li><strong>Manual - Operator Dependent</strong> - The control is Manual in the CIS benchmark and it depends on the cluster&#x27;s use case or some other factor that must be determined by the cluster operator. These controls have been evaluated to ensure RKE2 does not prevent their implementation, but no further configuration or auditing of the cluster under test has been performed.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="controls">Controls<a class="hash-link" href="#controls" title="Direct link to heading">​</a></h3><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-master-node-security-configuration">1 Master Node Security Configuration<a class="hash-link" href="#1-master-node-security-configuration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-master-node-configuration-files">1.1 Master Node Configuration Files<a class="hash-link" href="#11-master-node-configuration-files" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="111">1.1.1<a class="hash-link" href="#111" title="Direct link to heading">​</a></h4><p>Ensure that the API server pod specification file permissions are set to 644 or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The API server pod specification file controls various parameters that set the behavior of the API server. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>644</code> permissions. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="112">1.1.2<a class="hash-link" href="#112" title="Direct link to heading">​</a></h4><p>Ensure that the API server pod specification file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The API server pod specification file controls various parameters that set the behavior of the API server. You should set its file ownership to maintain the integrity of the file. The file should be owned by `root:root`.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>root:root</code> ownership. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="113">1.1.3<a class="hash-link" href="#113" title="Direct link to heading">​</a></h4><p>Ensure that the controller manager pod specification file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The controller manager pod specification file controls various parameters that set the behavior of the Controller Manager on the master node. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>644</code> permissions. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="114">1.1.4<a class="hash-link" href="#114" title="Direct link to heading">​</a></h4><p>Ensure that the controller manager pod specification file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The controller manager pod specification file controls various parameters that set the behavior of various components of the master node. You should set its file ownership to maintain the integrity of the file. The file should be owned by root:root.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>root:root</code> ownership. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="115">1.1.5<a class="hash-link" href="#115" title="Direct link to heading">​</a></h4><p>Ensure that the scheduler pod specification file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The scheduler pod specification file controls various parameters that set the behavior of the Scheduler service in the master node. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>644</code> permissions. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="116">1.1.6<a class="hash-link" href="#116" title="Direct link to heading">​</a></h4><p>Ensure that the scheduler pod specification file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The scheduler pod specification file controls various parameters that set the behavior of the kube-scheduler service in the master node. You should set its file ownership to maintain the integrity of the file. The file should be owned by root:root.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>root:root</code> ownership. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="117">1.1.7<a class="hash-link" href="#117" title="Direct link to heading">​</a></h4><p>Ensure that the etcd pod specification file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The etcd pod specification file /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml controls various parameters that set the behavior of the etcd service in the master node. etcd is a highly-available key-value store which Kubernetes uses for persistent storage of all of its REST API object. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>644</code> permissions. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="118">1.1.8<a class="hash-link" href="#118" title="Direct link to heading">​</a></h4><p>Ensure that the etcd pod specification file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The etcd pod specification file /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml controls various parameters that set the behavior of the etcd service in the master node. etcd is a highly-available key-value store which Kubernetes uses for persistent storage of all of its REST API object. You should set its file ownership to maintain the integrity of the file. The file should be owned by root:root.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates these files with <code>root:root</code> ownership. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="119">1.1.9<a class="hash-link" href="#119" title="Direct link to heading">​</a></h4><p>Ensure that the Container Network Interface file permissions are set to 644 or more restrictive (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Container Network Interface provides various networking options for overlay networking. You should consult their documentation and restrict their respective file permissions to maintain the integrity of those files. Those files should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/server/manifests/rke2-canal.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
RKE2 deploys the default CNI, Canal, using a Helm chart. The chart is defined as a custom resource in a file with <code>644</code> permissions. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1110">1.1.10<a class="hash-link" href="#1110" title="Direct link to heading">​</a></h4><p>Ensure that the Container Network Interface file ownership is set to <code>root:root</code> (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Container Network Interface provides various networking options for overlay networking. You should consult their documentation and restrict their respective file permissions to maintain the integrity of those files. Those files should be owned by root:root.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/manifests/rke2-canal.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
RKE2 deploys the default CNI, Canal, using a Helm chart. The chart is defined as a custom resource in a file with <code>root:root</code> ownership. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1111">1.1.11<a class="hash-link" href="#1111" title="Direct link to heading">​</a></h4><p>Ensure that the etcd data directory permissions are set to 700 or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key-value store used by Kubernetes deployments for persistent storage of all of its REST API objects. This data directory should be protected from any unauthorized reads or writes. It should not be readable or writable by any group members or the world.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/server/db/etcd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">700</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
RKE2 manages the etcd data directory and sets its permissions to 700. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1112">1.1.12<a class="hash-link" href="#1112" title="Direct link to heading">​</a></h4><p>Ensure that the etcd data directory ownership is set to <code>etcd:etcd</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key-value store used by Kubernetes deployments for persistent storage of all of its REST API objects. This data directory should be protected from any unauthorized reads or writes. It should be owned by etcd:etcd.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/db/etcd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">etcd:etcd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
When running RKE2 with the <code>profile</code> flag set to <code>cis-1.23</code>, RKE2 will refuse to start if the <code>etcd</code> user and group doesn&#x27;t exist on the host. If it does exist, RKE2 will automatically set the ownership of the etcd data directory to <code>etcd:etcd</code> and ensure the etcd static pod is started with that user and group.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1113">1.1.13<a class="hash-link" href="#1113" title="Direct link to heading">​</a></h4><p>Ensure that the <code>admin.conf</code> file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The admin.conf is the administrator kubeconfig file defining various settings for the administration of the cluster. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.<p>In RKE2, this file is located at <code>/var/lib/rancher/rke2/server/cred/admin.kubeconfig</code>.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/server/cred/admin.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates this file at <code>/var/lib/rancher/rke2/server/cred/admin.kubeconfig</code> and automatically sets its permissions to <code>644</code>. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1114">1.1.14<a class="hash-link" href="#1114" title="Direct link to heading">​</a></h4><p>Ensure that the admin.conf file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The admin.conf file contains the admin credentials for the cluster. You should set its file ownership to maintain the integrity of the file. The file should be owned by root:root.<p>In RKE2, this file is located at <code>/var/lib/rancher/rke2/server/cred/admin.kubeconfig</code>.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/cred/admin.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates this file at <code>stat -c %U:%G /var/lib/rancher/rke2/server/cred/admin.kubeconfig</code> and automatically sets its ownership to <code>root:root</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1115">1.1.15<a class="hash-link" href="#1115" title="Direct link to heading">​</a></h4><p>Ensure that the <code>scheduler.conf</code> file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q"><p>The scheduler.conf file is the kubeconfig file for the Scheduler. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</p><p>In RKE2, this file is located at <code>/var/lib/rancher/rke2/server/cred/scheduler.kubeconfig</code>.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/server/cred/scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates this file at <code>/var/lib/rancher/rke2/server/cred/scheduler.kubeconfig</code> and automatically sets its permissions to <code>644</code>. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1116">1.1.16<a class="hash-link" href="#1116" title="Direct link to heading">​</a></h4><p>Ensure that the <code>scheduler.conf</code> file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The scheduler.conf file is the kubeconfig file for the Scheduler. You should set its file ownership to maintain the integrity of the file. The file should be owned by root:root.<p>In RKE2, this file is located at <code>/var/lib/rancher/rke2/server/cred/scheduler.kubeconfig</code>.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/cred/scheduler.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates this file at <code>/var/lib/rancher/rke2/server/cred/scheduler.kubeconfig</code> and automatically sets its ownership to <code>root:root</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1117">1.1.17<a class="hash-link" href="#1117" title="Direct link to heading">​</a></h4><p>Ensure that the <code>controller.kubeconfig</code> file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The controller.kubeconfig file is the kubeconfig file for the Scheduler. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.<p>In RKE2, this file is located at <code>/var/lib/rancher/rke2/server/cred/controller.kubeconfig</code>.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/server/cred/controller.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates this file at <code>/var/lib/rancher/rke2/server/cred/controller.kubeconfig</code> and automatically sets its permissions to <code>644</code>. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1118">1.1.18<a class="hash-link" href="#1118" title="Direct link to heading">​</a></h4><p>Ensure that the <code>controller.kubeconfig</code> file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The controller.kubeconfig file is the kubeconfig file for the Scheduler. You should set its file ownership to maintain the integrity of the file. The file should be owned by root:root.<p>In RKE2, this file is located at <code>/var/lib/rancher/rke2/server/cred/controller.kubeconfig</code>.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/cred/controller.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates this file at <code>/var/lib/rancher/rke2/server/cred/controller.kubeconfig</code> and automatically sets its ownership to <code>root:root</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1119">1.1.19<a class="hash-link" href="#1119" title="Direct link to heading">​</a></h4><p>Ensure that the Kubernetes PKI directory and file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes makes use of a number of certificates as part of its operation. You should set the ownership of the directory containing the PKI information and all files in that directory to maintain their integrity. The directory and files should be owned by root:root.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/tls</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates the directory and files with the expected ownership of <code>root:root</code>. No manual remediation should be necessary.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1120">1.1.20<a class="hash-link" href="#1120" title="Direct link to heading">​</a></h4><p>Ensure that the Kubernetes PKI certificate file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes makes use of a number of certificate files as part of the operation of its components. The permissions on these files should be set to 644 or more restrictive to protect their integrity.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"> %a /var/lib/rancher/rke2/server/tls/*.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the permissions are <code>644</code> or more restrictive.</p><p><strong>Remediation:</strong>
By default, RKE2 creates the files with the expected permissions of <code>644</code>. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1121">1.1.21<a class="hash-link" href="#1121" title="Direct link to heading">​</a></h4><p>Ensure that the Kubernetes PKI key file permissions are set to <code>600</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes makes use of a number of key files as part of the operation of its components. The permissions on these files should be set to 600 to protect their integrity and confidentiality.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"> %a /var/lib/rancher/rke2/server/tls/*.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the permissions are <code>600</code> or more restrictive.</p><p><strong>Remediation:</strong>
By default, RKE2 creates the files with the expected permissions of <code>600</code>. No manual remediation is needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-api-server">1.2 API Server<a class="hash-link" href="#12-api-server" title="Direct link to heading">​</a></h3><p>This section contains recommendations relating to API server configuration flags</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="121">1.2.1<a class="hash-link" href="#121" title="Direct link to heading">​</a></h4><p>Ensure that the --anonymous-auth argument is set to false (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">When enabled, requests that are not rejected by other configured authentication methods are treated as anonymous requests. These requests are then served by the API server. You should rely on authentication to authorize access and disallow anonymous requests.<p>If you are using RBAC authorization, it is generally considered reasonable to allow anonymous access to the API Server for health checks and discovery purposes, and hence this recommendation is Manual. However, you should consider whether anonymous discovery is an acceptable risk for your purposes.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that <code>--anonymous-auth=false</code> is present.</p><p><strong>Remediation:</strong>
By default, RKE2 kube-apiserver is configured to run with this flag and value. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="122">1.2.2<a class="hash-link" href="#122" title="Direct link to heading">​</a></h4><p>Ensure that the --token-auth-file parameter is not set (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The token-based authentication utilizes static tokens to authenticate requests to the apiserver. The tokens are stored in clear-text in a file on the apiserver, and cannot be revoked or rotated without restarting the apiserver. Hence, do not use static token-based authentication.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--token-auth-file</code> argument does not exist.</p><p><strong>Remediation:</strong>
By default, RKE2 does not run with token authentication enabled. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="123">1.2.3<a class="hash-link" href="#123" title="Direct link to heading">​</a></h4><p>Ensure that the --DenyServiceExternalIPs is not set (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">This admission controller rejects all net-new usage of the Service field externalIPs. This feature is very powerful (allows network traffic interception) and not well controlled by policy. When enabled, users of the cluster may not create new Services which use externalIPs and may not add new values to externalIPs on existing Service objects. Existing uses of externalIPs are not affected, and users may remove values from externalIPs on existing Service objects.<p>Most users do not need this feature at all, and cluster admins should consider disabling it. Clusters that do need to use this feature should consider using some custom policy to manage usage of it.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--enable-admission-plugins</code> argument does not have <code>DenyServiceExternalIPs</code>.</p><p><strong>Remediation:</strong>
By default, RKE2 does not set <code>DenyServiceExternalIPs</code> to the admission plugin flag. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="124">1.2.4<a class="hash-link" href="#124" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--kubelet-https</code> argument is set to true (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Connections from apiserver to kubelets could potentially carry sensitive data such as secrets and keys. It is thus important to use in-transit encryption for any communication between the apiserver and kubelets.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--kubelet-https</code> argument does not exist.</p><p><strong>Remediation:</strong>
By default, RKE2 kube-apiserver doesn&#x27;t run with the <code>--kubelet-https</code> parameter as it runs with TLS. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="125">1.2.5<a class="hash-link" href="#125" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--kubelet-client-certificate</code> and <code>--kubelet-client-key</code> arguments are set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The apiserver, by default, does not authenticate itself to the kubelet&#x27;s HTTPS endpoints. The requests from the apiserver are treated anonymously. You should set up certificate- based kubelet authentication to ensure that the apiserver authenticates itself to kubelets when submitting requests.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--kubelet-client-certificate</code> and <code>--kubelet-client-key</code> arguments exist and they are set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 kube-apiserver is ran with these arguments for secure communication with kubelet. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="126">1.2.6<a class="hash-link" href="#126" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--kubelet-certificate-authority</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The connections from the apiserver to the kubelet are used for fetching logs for pods, attaching (through kubectl) to running pods, and using the kubelet’s port-forwarding functionality. These connections terminate at the kubelet’s HTTPS endpoint. By default, the apiserver does not verify the kubelet’s serving certificate, which makes the connection subject to man-in-the-middle attacks, and unsafe to run over untrusted and/or public networks.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--kubelet-certificate-authority</code> argument exists and is set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 kube-apiserver is ran with this argument for secure communication with kubelet. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="127">1.2.7<a class="hash-link" href="#127" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--authorization-mode</code> argument is not set to <code>AlwaysAllow</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The API Server, can be configured to allow all requests. This mode should not be used on any production cluster.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the argument value doesn&#x27;t contain <code>AlwaysAllow</code>.</p><p><strong>Remediation:</strong>
By default, RKE2 sets <code>Node,RBAC</code> as the parameter to the <code>--authorization-mode</code> argument. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="128">1.2.8<a class="hash-link" href="#128" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--authorization-mode</code> argument includes <code>Node</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The Node authorization mode only allows kubelets to read Secret, ConfigMap, PersistentVolume, and PersistentVolumeClaim objects associated with their nodes.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify <code>Node</code> exists as a parameter to the argument.</p><p><strong>Remediation:</strong>
By default, RKE2 sets <code>Node,RBAC</code> as the parameter to the <code>--authorization-mode</code> argument. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="129">1.2.9<a class="hash-link" href="#129" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--authorization-mode</code> argument includes <code>RBAC</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Role Based Access Control (RBAC) allows fine-grained control over the operations that different entities can perform on different objects in the cluster. It is recommended to use the RBAC authorization mode.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify <code>RBAC</code> exists as a parameter to the argument.</p><p><strong>Remediation:</strong>
By default, RKE2 sets <code>Node,RBAC</code> as the parameter to the <code>--authorization-mode</code> argument. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1210">1.2.10<a class="hash-link" href="#1210" title="Direct link to heading">​</a></h4><p>Ensure that the admission control plugin EventRateLimit is set (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Using `EventRateLimit` admission control enforces a limit on the number of events that the API Server will accept in a given time slice. A misbehaving workload could overwhelm and DoS the API Server, making it unavailable. This particularly applies to a multi-tenant cluster, where there might be a small percentage of misbehaving tenants which could have a significant impact on the performance of the cluster overall. Hence, it is recommended to limit the rate of events that the API server will accept.<p>Note: This is an Alpha feature in the Kubernetes 1.15 release.</p></div></div></details><p><strong>Result:</strong> <strong>Manual - Operator Dependent</strong></p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--enable-admission-plugins</code> argument is set to a value that includes EventRateLimit.</p><p><strong>Remediation:</strong>
By default, RKE2 only sets <code>NodeRestriction,PodSecurityPolicy</code> as the parameter to the <code>--enable-admission-plugins</code> argument.
To configure this, follow the Kubernetes documentation and set the desired limits in a configuration file. Then refer to RKE2&#x27;s documentation to see how to supply additional api server configuration via the kube-apiserver-arg parameter.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1211">1.2.11<a class="hash-link" href="#1211" title="Direct link to heading">​</a></h4><p>Ensure that the admission control plugin <code>AlwaysAdmit</code> is not set (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Setting admission control plugin AlwaysAdmit allows all requests and do not filter any requests.<p>The AlwaysAdmit admission controller was deprecated in Kubernetes v1.13. Its behavior was equivalent to turning off all admission controllers.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that if the <code>--enable-admission-plugins</code> argument is set, its value does not include <code>AlwaysAdmit</code>.</p><p><strong>Remediation:</strong>
By default, RKE2 only sets <code>NodeRestriction,PodSecurityPolicy</code> as the parameter to the <code>--enable-admission-plugins</code> argument. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1212">1.2.12<a class="hash-link" href="#1212" title="Direct link to heading">​</a></h4><p>Ensure that the admission control plugin AlwaysPullImages is set (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Setting admission control policy to `AlwaysPullImages` forces every new pod to pull the required images every time. In a multi-tenant cluster users can be assured that their private images can only be used by those who have the credentials to pull them. Without this admission control policy, once an image has been pulled to a node, any pod from any user can use it simply by knowing the image’s name, without any authorization check against the image ownership. When this plug-in is enabled, images are always pulled prior to starting containers, which means valid credentials are required.</div></div></details><p><strong>Result:</strong> <strong>Manual - Operator Dependent</strong></p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--enable-admission-plugins</code> argument is set to a value that includes <code>AlwaysPullImages</code>.</p><p><strong>Remediation:</strong>
By default, RKE2 only sets <code>NodeRestriction,PodSecurityPolicy</code> as the parameter to the <code>--enable-admission-plugins</code> argument.
To configure this, follow the Kubernetes documentation and set the desired limits in a configuration file. Then refer to RKE2&#x27;s documentation to see how to supply additional api server configuration via the kube-apiserver-arg parameter.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1213">1.2.13<a class="hash-link" href="#1213" title="Direct link to heading">​</a></h4><p>Ensure that the admission control plugin SecurityContextDeny is set if PodSecurityPolicy is not used (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">SecurityContextDeny can be used to provide a layer of security for clusters which do not have PodSecurityPolicies enabled.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--enable-admission-plugins</code> argument is set to a value that includes <code>SecurityContextDeny</code>, if <code>PodSecurityPolicy</code> is not included.</p><p><strong>Remediation:</strong>
By default, RKE2 automatically enables the <code>PodSecurityPolicy</code> admission plugin. Therefore, the <code>SecurityContextDeny</code> plugin need not be enabled. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1214">1.2.14<a class="hash-link" href="#1214" title="Direct link to heading">​</a></h4><p>Ensure that the admission control plugin <code>ServiceAccount</code> is set (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">When you create a pod, if you do not specify a service account, it is automatically assigned the `default` service account in the same namespace. You should create your own service account and let the API server manage its security tokens.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--disable-admission-plugins</code> argument is set to a value that does not includes <code>ServiceAccount</code>.</p><p><strong>Remediation:</strong>
By default, RKE2 does not use this argument. If there&#x27;s a desire to use this argument, follow the documentation and create ServiceAccount objects as per your environment. Then refer to RKE2&#x27;s documentation to see how to supply additional api server configuration via the kube-apiserver-arg parameter.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1215">1.2.15<a class="hash-link" href="#1215" title="Direct link to heading">​</a></h4><p>Ensure that the admission control plugin <code>NamespaceLifecycle</code> is set (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Setting admission control policy to `NamespaceLifecycle` ensures that objects cannot be created in non-existent namespaces, and that namespaces undergoing termination are not used for creating the new objects. This is recommended to enforce the integrity of the namespace termination process and also for the availability of the newer objects.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--disable-admission-plugins</code> argument is set to a value that does not include <code>NamespaceLifecycle</code>.</p><p><strong>Remediation:</strong>
By default, RKE2 does not use this argument. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1216">1.2.16<a class="hash-link" href="#1216" title="Direct link to heading">​</a></h4><p>Ensure that the admission control plugin NodeRestriction is set (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Using the NodeRestriction plug-in ensures that the kubelet is restricted to the Node and Pod objects that it could modify as defined. Such kubelets will only be allowed to modify their own Node API object, and only modify Pod API objects that are bound to their node.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--enable-admission-plugins</code> argument is set to a value that includes <code>NodeRestriction</code>.</p><p><strong>Remediation:</strong>
By default, RKE2 only sets <code>NodeRestriction</code> as the parameter to the <code>--enable-admission-plugins</code> argument. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1217">1.2.17<a class="hash-link" href="#1217" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--secure-port</code> argument is not set to <code>0</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The secure port is used to serve https with authentication and authorization. If you disable it, no https traffic is served and all traffic is served unencrypted.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--secure-port</code> argument is either not set or is set to an integer value between 1 and 65535.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the parameter of 6443 for the <code>--secure-port</code> argument. No manual remediation is needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1218">1.2.18<a class="hash-link" href="#1218" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--profiling</code> argument is set to <code>false</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Profiling allows for the identification of specific performance bottlenecks. It generates a significant amount of program data that could potentially be exploited to uncover system and program details. If you are not experiencing any bottlenecks and do not need the profiler for troubleshooting purposes, it is recommended to turn it off to reduce the potential attack surface.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--profiling</code> argument is set to false.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--profiling</code> flag parameter to false. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1219">1.2.19<a class="hash-link" href="#1219" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--audit-log-path</code> argument is set (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Auditing the Kubernetes API Server provides a security-relevant chronological set of records documenting the sequence of activities that have affected system by individual users, administrators or other components of the system. Even though currently, Kubernetes provides only basic audit capabilities, it should be enabled. You can enable it by setting an appropriate audit log path.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--audit-log-path</code> argument is set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--audit-log-path</code> argument and parameter. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1220">1.2.20<a class="hash-link" href="#1220" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--audit-log-maxage</code> argument is set to <code>30</code> or as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Retaining logs for at least 30 days ensures that you can go back in time and investigate or correlate any events. Set your audit log retention period to 30 days or as per your business requirements.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--audit-log-maxage</code> argument is set to 30 or as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--audit-log-maxage</code> argument parameter to 30. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1221">1.2.21<a class="hash-link" href="#1221" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--audit-log-maxbackup</code> argument is set to <code>10</code> or as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes automatically rotates the log files. Retaining old log files ensures that you would have sufficient log data available for carrying out any investigation or correlation. For example, if you have set file size of 100 MB and the number of old log files to keep as 10, you would approximate have 1 GB of log data that you could potentially use for your analysis.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--audit-log-maxbackup</code> argument is set to 10 or as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--audit-log-maxbackup</code> argument parameter to 10. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1222">1.2.22<a class="hash-link" href="#1222" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--audit-log-maxsize</code> argument is set to <code>100</code> or as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes automatically rotates the log files. Retaining old log files ensures that you would have sufficient log data available for carrying out any investigation or correlation. If you have set file size of 100 MB and the number of old log files to keep as 10, you would approximate have 1 GB of log data that you could potentially use for your analysis.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--audit-log-maxsize</code> argument is set to 100 or as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--audit-log-maxsize</code> argument parameter to 100. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1223">1.2.23<a class="hash-link" href="#1223" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--request-timeout</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Setting global request timeout allows extending the API server request timeout limit to a duration appropriate to the user&#x27;s connection speed. By default, it is set to 60 seconds which might be problematic on slower connections making cluster resources inaccessible once the data volume for requests exceeds what can be transmitted in 60 seconds. But, setting this timeout limit to be too large can exhaust the API server resources making it prone to Denial-of-Service attack. Hence, it is recommended to set this limit as appropriate and change the default limit of 60 seconds only if needed.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--request-timeout</code> argument is either not set or set to an appropriate value.</p><p><strong>Remediation:</strong>
By default, RKE2 does not set the <code>--request-timeout</code> argument. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1224">1.2.24<a class="hash-link" href="#1224" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--service-account-lookup</code> argument is set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">If `--service-account-lookup` is not enabled, the apiserver only verifies that the authentication token is valid, and does not validate that the service account token mentioned in the request is actually present in etcd. This allows using a service account token even after the corresponding service account is deleted. This is an example of time of check to time of use security issue.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that if the <code>--service-account-lookup</code> argument exists it is set to true.</p><p><strong>Remediation:</strong>
By default, RKE2 doesn&#x27;t set this argument in favor of taking the default effect. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1225">1.2.25<a class="hash-link" href="#1225" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--service-account-key-file</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">By default, if no `--service-account-key-file` is specified to the apiserver, it uses the private key from the TLS serving certificate to verify service account tokens. To ensure that the keys for service account tokens could be rotated as needed, a separate public/private key pair should be used for signing service account tokens. Hence, the public key should be specified to the apiserver with `--service-account-key-file`.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--service-account-key-file</code> argument exists and is set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--service-account-key-file</code> explicitly. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1226">1.2.26<a class="hash-link" href="#1226" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--etcd-certfile</code> and <code>--etcd-keyfile</code> arguments are set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should be protected by client authentication. This requires the API server to identify itself to the etcd server using a client certificate and key.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--etcd-certfile</code> and <code>--etcd-keyfile</code> arguments exist and they are set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--etcd-certfile</code> and <code>--etcd-keyfile</code> arguments explicitly. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1227">1.2.27<a class="hash-link" href="#1227" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--tls-cert-file</code> and <code>--tls-private-key-file</code> arguments are set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">API server communication contains sensitive parameters that should remain encrypted in transit. Configure the API server to serve only HTTPS traffic.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--tls-cert-file</code> and <code>--tls-private-key-file</code> arguments exist and they are set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--tls-cert-file</code> and <code>--tls-private-key-file</code> arguments explicitly. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1228">1.2.28<a class="hash-link" href="#1228" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--client-ca-file</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">API server communication contains sensitive parameters that should remain encrypted in transit. Configure the API server to serve only HTTPS traffic. If `--client-ca-file` argument is set, any request presenting a client certificate signed by one of the authorities in the `client-ca-file` is authenticated with an identity corresponding to the CommonName of the client certificate.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--client-ca-file</code> argument exists and it is set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--client-ca-file</code> argument explicitly. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1229">1.2.29<a class="hash-link" href="#1229" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--etcd-cafile</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should be protected by client authentication. This requires the API server to identify itself to the etcd server using a SSL Certificate Authority file.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--etcd-cafile</code> argument exists and it is set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--etcd-cafile</code> argument explicitly. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1230">1.2.30<a class="hash-link" href="#1230" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--encryption-provider-config</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly available key-value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should be encrypted at rest to avoid any disclosures.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--encryption-provider-config</code> argument is set to a EncryptionConfigfile. Additionally, ensure that the <code>EncryptionConfigfile</code> has all the desired resources covered especially any secrets.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--encryption-provider-config</code> argument explicitly. No manual remediation needed. RKE2&#x27;s default encryption provider config file is located at <code>/var/lib/rancher/rke2/server/cred/encryption-config.json</code> and is configured to encrypt secrets.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1231">1.2.31<a class="hash-link" href="#1231" title="Direct link to heading">​</a></h4><p>Ensure that encryption providers are appropriately configured (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Where `etcd` encryption is used, it is important to ensure that the appropriate set of encryption providers is used. Currently, the `aescbc`, `kms` and `secretbox` are likely to be appropriate options.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Remediation:</strong>
Follow the Kubernetes documentation and configure a <code>EncryptionConfig</code> file.
In this file, choose <strong>aescbc</strong>, <strong>kms</strong> or <strong>secretbox</strong> as the encryption provider.</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> aescbc /var/lib/rancher/rke2/server/cred/encryption-config.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run the below command on the master node.</p><p>Verify that aescbc is set as the encryption provider for all the desired resources.</p><p><strong>Remediation</strong>
By default, RKE2 sets the argument <code>--encryption-provider-config</code> and parameter. The contents of the config file indicates the use of aescbc. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1232">1.2.32<a class="hash-link" href="#1232" title="Direct link to heading">​</a></h4><p>Ensure that the API Server only makes use of Strong Cryptographic Ciphers (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">TLS ciphers have had a number of known vulnerabilities and weaknesses, which can reduce the protection provided by them. By default Kubernetes supports a number of TLS ciphersuites including some that have security concerns, weakening the protection provided.</div></div></details><p><strong>Result:</strong> <strong>Manual - Operator Dependent</strong></p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--tls-cipher-suites</code> argument is set as outlined in the remediation procedure below.</p><p><strong>Remediation:</strong>
By default, RKE2 explicitly doesn&#x27;t set this flag. No manual remediation needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-controller-manager">1.3 Controller Manager<a class="hash-link" href="#13-controller-manager" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="131">1.3.1<a class="hash-link" href="#131" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--terminated-pod-gc-threshold</code> argument is set as appropriate (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Garbage collection is important to ensure sufficient resource availability and avoiding degraded performance and availability. In the worst case, the system might crash or just be unusable for a long period of time. The current setting for garbage collection is 12,500 terminated pods which might be too high for your system to sustain. Based on your system resources and tests, choose an appropriate threshold value to activate garbage collection.</div></div></details><p><strong>Result:</strong> <strong>Manual - Operator Dependent</strong></p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-controller-manager </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--terminated-pod-gc-threshold</code> argument is set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--terminated-pod-gc-threshold</code> argument with a value of 1000. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="132">1.3.2<a class="hash-link" href="#132" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--profiling</code> argument is set to false (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Profiling allows for the identification of specific performance bottlenecks. It generates a significant amount of program data that could potentially be exploited to uncover system and program details. If you are not experiencing any bottlenecks and do not need the profiler for troubleshooting purposes, it is recommended to turn it off to reduce the potential attack surface.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-controller-manager </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--profiling</code> argument is set to false.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--profiling</code> flag parameter to false. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="133">1.3.3<a class="hash-link" href="#133" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--use-service-account-credentials</code> argument is set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The controller manager creates a service account per controller in the `kube-system` namespace, generates a credential for it, and builds a dedicated API client with that service account credential for each controller loop to use. Setting the `--use-service-account-credentials` to `true` runs each control loop within the controller manager using a separate service account credential. When used in combination with RBAC, this ensures that the control loops run with the minimum permissions required to perform their intended tasks.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-controller-manager </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--use-service-account-credentials</code> argument is set to true.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--use-service-account-credentials</code> argument to true. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="134">1.3.4<a class="hash-link" href="#134" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--service-account-private-key-file</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">To ensure that keys for service account tokens can be rotated as needed, a separate public/private key pair should be used for signing service account tokens. The private key should be specified to the controller manager with `--service-account-private-key-file` as appropriate.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-controller-manager </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--service-account-private-key-file</code> argument is set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--service-account-private-key-file</code> argument with the service account key file. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="135">1.3.5<a class="hash-link" href="#135" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--root-ca-file</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Processes running within pods that need to contact the API server must verify the API server&#x27;s serving certificate. Failing to do so could be a subject to man-in-the-middle attacks.<p>Providing the root certificate for the API server&#x27;s serving certificate to the controller manager with the <code>--root-ca-file</code> argument allows the controller manager to inject the trusted bundle into pods so that they can verify TLS connections to the API server.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-controller-manager </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--root-ca-file</code> argument exists and is set to a certificate bundle file containing the root certificate for the API server&#x27;s serving certificate</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--root-ca-file</code> argument with the root ca file. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="136">1.3.6<a class="hash-link" href="#136" title="Direct link to heading">​</a></h4><p>Ensure that the <code>RotateKubeletServerCertificate</code> argument is set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">`RotateKubeletServerCertificate` causes the kubelet to both request a serving certificate after bootstrapping its client credentials and rotate the certificate as its existing credentials expire. This automated periodic rotation ensures that the there are no downtimes due to expired certificates and thus addressing availability in the CIA security triad.<p>Note: This recommendation only applies if you let kubelets get their certificates from the API server. In case your kubelet certificates come from an outside authority/tool (e.g. Vault) then you need to take care of rotation yourself.</p></div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-controller-manager </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that RotateKubeletServerCertificateargument exists and is set to true.</p><p><strong>Remediation:</strong>
By default, RKE2 implements it&#x27;s own logic for certificate generation and rotation.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="137">1.3.7<a class="hash-link" href="#137" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--bind-address</code> argument is set to <code>127.0.0.1</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The Controller Manager API service which runs on port 10252/TCP by default is used for health and metrics information and is available without authentication or encryption. As such it should only be bound to a localhost interface, to minimize the cluster&#x27;s attack surface.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-controller-manager </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--bind-address</code> argument is set to 127.0.0.1.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--bind-address</code> argument to <code>127.0.0.1</code>. No manual remediation needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-scheduler">1.4 Scheduler<a class="hash-link" href="#14-scheduler" title="Direct link to heading">​</a></h3><p>This section contains recommendations relating to Scheduler configuration flags</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="141">1.4.1<a class="hash-link" href="#141" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--profiling</code> argument is set to <code>false</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Profiling allows for the identification of specific performance bottlenecks. It generates a significant amount of program data that could potentially be exploited to uncover system and program details. If you are not experiencing any bottlenecks and do not need the profiler for troubleshooting purposes, it is recommended to turn it off to reduce the potential attack surface.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-scheduler </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--profiling</code> argument is set to false.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--profiling</code> flag parameter to false. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="142">1.4.2<a class="hash-link" href="#142" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--bind-address</code> argument is set to <code>127.0.0.1</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q"><p>The Scheduler API service which runs on port 10251/TCP by default is used for health and metrics information and is available without authentication or encryption. As such it should only be bound to a localhost interface, to minimize the cluster&#x27;s attack surface.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-scheduler </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--bind-address</code> argument is set to 127.0.0.1.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--bind-address</code> argument to <code>127.0.0.1</code>. No manual remediation needed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-etcd-node-configuration">2 Etcd Node Configuration<a class="hash-link" href="#2-etcd-node-configuration" title="Direct link to heading">​</a></h2><p>This section covers recommendations for etcd configuration.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="21">2.1<a class="hash-link" href="#21" title="Direct link to heading">​</a></h4><p>Ensure that the <code>cert-file</code> and <code>key-file</code> fields are set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should be encrypted in transit.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -E </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cert-file|key-file&#x27;</span><span class="token plain"> /var/lib/rancher/rke2/server/db/etcd/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the	<code>cert-file</code> and the <code>key-file</code> fields are set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 uses a config file for etcd that can be found at <code>/var/lib/rancher/rke2/server/db/etcd/config</code>. Server and peer cert and key files are specified. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="22">2.2<a class="hash-link" href="#22" title="Direct link to heading">​</a></h4><p>Ensure that the <code>client-cert-auth</code> field is set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should not be available to unauthenticated clients. You should enable the client authentication via valid certificates to secure the access to the etcd service.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;client-cert-auth&#x27;</span><span class="token plain"> /var/lib/rancher/rke2/server/db/etcd/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>client-cert-auth</code> field is set to true.</p><p><strong>Remediation:</strong>
By default, RKE2 uses a config file for etcd that can be found at <code>/var/lib/rancher/rke2/server/db/etcd/config</code>. <code>client-cert-auth</code> is set to true. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="23">2.3<a class="hash-link" href="#23" title="Direct link to heading">​</a></h4><p>Ensure that the <code>auto-tls</code> field is not set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should not be available to unauthenticated clients. You should enable the client authentication via valid certificates to secure the access to the etcd service.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;auto-tls&#x27;</span><span class="token plain"> /var/lib/rancher/rke2/server/db/etcd/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that if the <code>auto-tls</code> field does not exist.</p><p><strong>Remediation:</strong>
By default, RKE2 uses a config file for etcd that can be found at <code>/var/lib/rancher/rke2/server/db/etcd/config</code>. Within the file, it does not contain the <code>auto-tls</code> argument. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="24">2.4<a class="hash-link" href="#24" title="Direct link to heading">​</a></h4><p>Ensure that the <code>peer-cert-file</code> and <code>peer-key-file</code> fields are set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should be encrypted in transit and also amongst peers in the etcd clusters.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -E </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;peer-server-client.crt|peer-server-client.key&#x27;</span><span class="token plain"> /var/lib/rancher/rke2/server/db/etcd/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>peer-server-client.crt</code> and <code>peer-server-client.key</code> fields are set as appropriate.</p><p><strong>Remediation:</strong>
By default, RKE2 uses a config file for etcd that can be found at <code>/var/lib/rancher/rke2/server/db/etcd/config</code>. Within the file, the <code>peer-server-client.crt</code> and <code>peer-server-client.key</code> fields are set. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="25">2.5<a class="hash-link" href="#25" title="Direct link to heading">​</a></h4><p>Ensure that the peer-client-cert-auth argument is set to true (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should be accessible only by authenticated etcd peers in the etcd cluster.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;peer-client-cert-auth&#x27;</span><span class="token plain"> /var/lib/rancher/rke2/server/db/etcd/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>peer-client-cert-auth</code> field in the peer section is set to true.</p><p><strong>Remediation:</strong>
By default, RKE2 uses a config file for etcd that can be found at <code>/var/lib/rancher/rke2/server/db/etcd/config</code>. Within the file, the <code>client-cert-auth</code> field is set. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="26">2.6<a class="hash-link" href="#26" title="Direct link to heading">​</a></h4><p>Ensure that the <code>peer-auto-tls</code> field is not set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly-available key value store used by Kubernetes deployments for persistent storage of all of its REST API objects. These objects are sensitive in nature and should be accessible only by authenticated etcd peers in the etcd cluster. Hence, do not use self- signed certificates for authentication.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;peer-auto-tls&#x27;</span><span class="token plain"> /var/lib/rancher/rke2/server/db/etcd/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that if the <code>peer-auto-tls</code> field does not exist.</p><p><strong>Remediation:</strong>
By default, RKE2 uses a config file for etcd that can be found at <code>/var/lib/rancher/rke2/server/db/etcd/config</code>. Within the file, it does not contain the <code>peer-auto-tls</code> field. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="27">2.7<a class="hash-link" href="#27" title="Direct link to heading">​</a></h4><p>Ensure that a unique Certificate Authority is used for etcd (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">etcd is a highly available key-value store used by Kubernetes deployments for persistent storage of all of its REST API objects. Its access should be restricted to specifically designated clients and peers only.<p>Authentication to etcd is based on whether the certificate presented was issued by a trusted certificate authority. There is no checking of certificate attributes such as common name or subject alternative name. As such, if any attackers were able to gain access to any certificate issued by the trusted certificate authority, they would be able to gain full access to the etcd database.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># To find the ca file used by etcd:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;trusted-ca-file&#x27;</span><span class="token plain"> /var/lib/rancher/rke2/server/db/etcd/config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># To find the kube-apiserver process:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the file referenced by the <code>client-ca-file</code> flag in the apiserver process is different from the file referenced by the <code>trusted-ca-file</code> parameter in the etcd configuration file.</p><p><strong>Remediation:</strong>
By default, RKE2 uses a config file for etcd that can be found at <code>/var/lib/rancher/rke2/server/db/etcd/config</code> and the <code>trusted-ca-file</code> parameters in it are set to unique values specific to etcd. No manual remediation needed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-control-plane-configuration">3 Control Plane Configuration<a class="hash-link" href="#3-control-plane-configuration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-authentication-and-authorization">3.1 Authentication and Authorization<a class="hash-link" href="#31-authentication-and-authorization" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="311">3.1.1<a class="hash-link" href="#311" title="Direct link to heading">​</a></h4><p>Client certificate authentication should not be used for users (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">With any authentication mechanism the ability to revoke credentials if they are compromised or no longer required, is a key control. Kubernetes client certificate authentication does not allow for this due to a lack of support for certificate revocation.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Audit:</strong>
Review user access to the cluster and ensure that users are not making use of Kubernetes client certificate authentication.</p><p><strong>Remediation:</strong>
Alternative mechanisms provided by Kubernetes such as the use of OIDC should be implemented in place of client certificates.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-logging">3.2 Logging<a class="hash-link" href="#32-logging" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="321">3.2.1<a class="hash-link" href="#321" title="Direct link to heading">​</a></h4><p>Ensure that a minimal audit policy is created (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Logging is an important detective control for all systems, to detect potential unauthorised access.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kube-apiserver </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--audit-policy-file</code> is set. Review the contents of the file specified and ensure that it contains a valid audit policy.</p><p><strong>Remediation:</strong>
Create an audit policy file for your cluster.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="322">3.2.2<a class="hash-link" href="#322" title="Direct link to heading">​</a></h4><p>Ensure that the audit policy covers key security concerns (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Security audit logs should cover access and modification of key resources in the cluster, to enable them to form an effective part of a security environment.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-worker-node-security-configuration">4 Worker Node Security Configuration<a class="hash-link" href="#4-worker-node-security-configuration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-worker-node-configuration-files">4.1 Worker Node Configuration Files<a class="hash-link" href="#41-worker-node-configuration-files" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="411">4.1.1<a class="hash-link" href="#411" title="Direct link to heading">​</a></h4><p>Ensure that the kubelet service file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The `kubelet` service file controls various parameters that set the behavior of the kubelet service in the worker node. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Remediation:</strong>
RKE2 doesn’t launch the kubelet as a service. It is launched and managed by the RKE2 supervisor process. All configuration is passed to it as command line arguments at run time.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="412">4.1.2<a class="hash-link" href="#412" title="Direct link to heading">​</a></h4><p>Ensure that the kubelet service file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The `kubelet` service file controls various parameters that set the behavior of the kubelet service in the worker node. You should set its file ownership to maintain the integrity of the file. The file should be owned by `root:root`.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Remediation:</strong>
RKE2 doesn’t launch the kubelet as a service. It is launched and managed by the RKE2 supervisor process. All configuration is passed to it as command line arguments at run time.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="413">4.1.3<a class="hash-link" href="#413" title="Direct link to heading">​</a></h4><p>Ensure that the proxy kubeconfig file permissions are set to <code>644</code> or more restrictive (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The `kube-proxy` kubeconfig file controls various parameters of the `kube-proxy` service in the worker node. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.<p>It is possible to run <code>kube-proxy</code> with the kubeconfig parameters configured as a Kubernetes ConfigMap instead of a file. In this case, there is no proxy kubeconfig file.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the worker node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/server/manifests/rke2-kube-proxy.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that if a file is specified and it exists, the permissions are 644 or more restrictive.</p><p><strong>Remediation:</strong>
By derfault, RKE2 creates <code>rke2-kube-proxy.yaml</code> with <code>644</code> permissions. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="414">4.1.4<a class="hash-link" href="#414" title="Direct link to heading">​</a></h4><p>Ensure that the proxy kubeconfig file ownership is set to <code>root:root</code> (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The kubeconfig file for `kube-proxy` controls various parameters for the `kube-proxy` service in the worker node. You should set its file ownership to maintain the integrity of the file. The file should be owned by `root:root`.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/manifests/rke2-kube-proxy.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that if a file is specified and it exists, the permissions are 644 or more restrictive.</p><p><strong>Remediation:</strong>
By default, RKE2 creates <code>rke2-kube-proxy.yaml</code> with <code>root:root</code> ownership. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="415">4.1.5<a class="hash-link" href="#415" title="Direct link to heading">​</a></h4><p>Ensure that the kubelet.conf file permissions are set to <code>644</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The `kubelet.conf` file is the kubeconfig file for the node, and controls various parameters that set the behavior and identity of the worker node. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Audit:</strong>
Run the below command on the worker node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/agent/kubelet.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By derfault, RKE2 creates <code>kubelet.kubeconfig</code> with <code>644</code> permissions. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="416">4.1.6<a class="hash-link" href="#416" title="Direct link to heading">​</a></h4><p>Ensure that the kubelet.conf file ownership is set to <code>root:root</code> (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The `kubelet.conf` file is the kubeconfig file for the node, and controls various parameters that set the behavior and identity of the worker node. You should set its file ownership to maintain the integrity of the file. The file should be owned by `root:root`.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/agent/kubelet.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates <code>kubelet.kubeconfig</code> with <code>root:root</code> ownership. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="417">4.1.7<a class="hash-link" href="#417" title="Direct link to heading">​</a></h4><p>Ensure that the certificate authorities file permissions are set to <code>644</code> or more restrictive (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The certificate authorities file controls the authorities used to validate API requests. You should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %a /var/lib/rancher/rke2/server/tls/server-ca.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">644</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the permissions are 644.</p><p><strong>Remediation:</strong>
By default, RKE2 creates <code>/var/lib/rancher/rke2/server/tls/server-ca.crt</code> with 644 permissions.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="418">4.1.8<a class="hash-link" href="#418" title="Direct link to heading">​</a></h4><p>Ensure that the client certificate authorities file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The certificate authorities file controls the authorities used to validate API requests. You should set its file ownership to maintain the integrity of the file. The file should be owned by `root:root`.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">stat</span><span class="token plain"> -c %U:%G /var/lib/rancher/rke2/server/tls/client-ca.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 creates <code>/var/lib/rancher/rke2/server/tls/client-ca.crt</code> with <code>root:root</code> ownership.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="419">4.1.9<a class="hash-link" href="#419" title="Direct link to heading">​</a></h4><p>Ensure that the kubelet configuration file has permissions set to <code>600</code> or more restrictive (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The kubelet reads various parameters, including security settings, from a config file specified by the `--config` argument. If this file is specified you should restrict its file permissions to maintain the integrity of the file. The file should be writable by only the administrators on the system.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Remediation:</strong>
RKE2 doesn’t require or maintain a configuration file for the kubelet process. All configuration is passed to it as command line arguments at run time.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4110">4.1.10<a class="hash-link" href="#4110" title="Direct link to heading">​</a></h4><p>Ensure that the kubelet configuration file ownership is set to <code>root:root</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The kubelet reads various parameters, including security settings, from a config file specified by the `--config` argument. If this file is specified you should restrict its file permissions to maintain the integrity of the file. The file should be owned by `root:root`.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Remediation:</strong>
RKE2 doesn’t require or maintain a configuration file for the kubelet process. All configuration is passed to it as command line arguments at run time.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-kubelet">4.2 Kubelet<a class="hash-link" href="#42-kubelet" title="Direct link to heading">​</a></h3><p>This section contains recommendations for kubelet configuration.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="421">4.2.1<a class="hash-link" href="#421" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--anonymous-auth</code> argument is set to false (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">When enabled, requests that are not rejected by other configured authentication methods are treated as anonymous requests. These requests are then served by the Kubelet server. You should rely on authentication to authorize access and disallow anonymous requests.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the value for <code>--anonymous-auth</code> is false.</p><p><strong>Remediation:</strong>
By default, RKE2 starts kubelet with <code>--anonymous-auth</code> set to false. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="422">4.2.2<a class="hash-link" href="#422" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--authorization-mode</code> argument is not set to <code>AlwaysAllow</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubelets, by default, allow all authenticated requests (even anonymous ones) without needing explicit authorization checks from the apiserver. You should restrict this behavior and only allow explicitly authorized requests.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that <code>AlwaysAllow</code> is not present.</p><p><strong>Remediation:</strong>
RKE2 starts kubelet with <code>Webhook</code> as the value for the <code>--authorization-mode</code> argument. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="423">4.2.3<a class="hash-link" href="#423" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--client-ca-file</code> argument is set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The connections from the apiserver to the kubelet are used for fetching logs for pods, attaching (through kubectl) to running pods, and using the kubelet’s port-forwarding functionality. These connections terminate at the kubelet’s HTTPS endpoint. By default, the apiserver does not verify the kubelet’s serving certificate, which makes the connection subject to man-in-the-middle attacks, and unsafe to run over untrusted and/or public networks. Enabling Kubelet certificate authentication ensures that the apiserver could authenticate the Kubelet before submitting any requests.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--client-ca-file</code> argument has a ca file associated.</p><p><strong>Remediation:</strong>
By default, RKE2 starts the kubelet process with the <code>--client-ca-file</code>. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="424">4.2.4<a class="hash-link" href="#424" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--read-only-port</code> argument is set to <code>0</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The Kubelet process provides a read-only API in addition to the main Kubelet API. Unauthenticated access is provided to this read-only API which could possibly retrieve potentially sensitive information about the cluster.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the <code>--read-only-port</code> argument is set to 0.</p><p><strong>Remediation:</strong>
By default, RKE2 starts the kubelet process with the <code>--read-only-port</code> argument set to 0.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="425">4.2.5<a class="hash-link" href="#425" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--streaming-connection-idle-timeout</code> argument is not set to <code>0</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Setting idle timeouts ensures that you are protected against Denial-of-Service attacks, inactive connections and running out of ephemeral ports.<p><strong>Note:</strong> By default, <code>--streaming-connection-idle-timeout</code> is set to 4 hours which might be too high for your environment. Setting this as appropriate would additionally ensure that such streaming connections are timed out after serving legitimate use cases.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that there&#x27;s nothing returned.</p><p><strong>Remediation:</strong>
By default, RKE2 does not set <code>--streaming-connection-idle-timeout</code> when starting kubelet.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="426">4.2.6<a class="hash-link" href="#426" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--protect-kernel-defaults</code> argument is set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kernel parameters are usually tuned and hardened by the system administrators before putting the systems into production. These parameters protect the kernel and the system. Your kubelet kernel defaults that rely on such parameters should be appropriately set to match the desired secured system state. Ignoring this could potentially lead to running pods with undesired kernel behavior.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
When running with the <code>profile</code> flag set to <code>cis-1.23</code>, RKE2 starts the kubelet process with the <code>--protect-kernel-defaults</code> argument set to true.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="427">4.2.7<a class="hash-link" href="#427" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--make-iptables-util-chains</code> argument is set to <code>true</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubelets can automatically manage the required changes to iptables based on how you choose your networking options for the pods. It is recommended to let kubelets manage the changes to iptables. This ensures that the iptables configuration remains in sync with pods networking configuration. Manually configuring iptables with dynamic pod network configuration changes might hamper the communication between pods/containers and to the outside world. You might have iptables rules too restrictive or too open.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify there are no results returned.</p><p><strong>Remediation:</strong>
By default, RKE2 does not set the <code>--make-iptables-util-chains</code> argument. No manual remediation needed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="428">4.2.8<a class="hash-link" href="#428" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--hostname-override</code> argument is not set (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Overriding hostnames could potentially break TLS setup between the kubelet and the apiserver. Additionally, with overridden hostnames, it becomes increasingly difficult to associate logs with a particular node and process them for security analytics. Hence, you should setup your kubelet nodes with resolvable FQDNs and avoid overriding the hostnames with IPs.</div></div></details><p><strong>Result:</strong> Not Applicable</p><p><strong>Remediation:</strong>
RKE2 does set this parameter for each host, but RKE2 also manages all certificates in the cluster. It ensures the hostname-override is included as a subject alternative name (SAN) in the kubelet&#x27;s certificate.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="429">4.2.9<a class="hash-link" href="#429" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--event-qps</code> argument is set to 0 or a level which ensures appropriate event capture (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">It is important to capture all events and not restrict event creation. Events are an important source of security information and analytics that ensure that your environment is consistently monitored using the event data.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
See CIS Benchmark guide for further details on configuring this.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4210">4.2.10<a class="hash-link" href="#4210" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--tls-cert-file</code> and <code>--tls-private-key-file</code> arguments are set as appropriate (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubelet communication contains sensitive parameters that should remain encrypted in transit. Configure the Kubelets to serve only HTTPS traffic.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify the <code>--tls-cert-file</code> and <code>--tls-private-key-file</code> arguments are present and set appropriately.</p><p><strong>Remediation:</strong>
By default, RKE2 sets the <code>--tls-cert-file</code> and <code>--tls-private-key-file</code> arguments when executing the kubelet process.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4211">4.2.11<a class="hash-link" href="#4211" title="Direct link to heading">​</a></h4><p>Ensure that the <code>--rotate-certificates</code> argument is not set to <code>false</code> (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q"><p>The <code>--rotate-certificates</code> setting causes the kubelet to rotate its client certificates by creating new CSRs as its existing credentials expire. This automated periodic rotation ensures that the there is no downtime due to expired certificates and thus addressing availability in the CIA security triad.</p><p><strong>Note:</strong> This recommendation only applies if you let kubelets get their certificates from the API server. In case your kubelet certificates come from an outside authority/tool (e.g. Vault) then you need to take care of rotation yourself.</p><p><strong>Note:</strong>This feature also require the <code>RotateKubeletClientCertificate</code> feature gate to be enabled (which is the default since Kubernetes v1.7)</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 implements it&#x27;s own logic for certificate generation and rotation.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4212">4.2.12<a class="hash-link" href="#4212" title="Direct link to heading">​</a></h4><p>Ensure that the <code>RotateKubeletServerCertificate</code> argument is set to <code>true</code> (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">`RotateKubeletServerCertificate` causes the kubelet to both request a serving certificate after bootstrapping its client credentials and rotate the certificate as its existing credentials expire. This automated periodic rotation ensures that the there are no downtimes due to expired certificates and thus addressing availability in the CIA security triad.<p>Note: This recommendation only applies if you let kubelets get their certificates from the API server. In case your kubelet certificates come from an outside authority/tool (e.g. Vault) then you need to take care of rotation yourself.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/bin/ps -ef </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> kubelet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -v </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
By default, RKE2 implements it&#x27;s own logic for certificate generation and rotation.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4213">4.2.13<a class="hash-link" href="#4213" title="Direct link to heading">​</a></h4><p>Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">TLS ciphers have had a number of known vulnerabilities and weaknesses, which can reduce the protection provided by them. By default Kubernetes supports a number of TLS ciphersuites including some that have security concerns, weakening the protection provided.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
Configuration of the parameter is dependent on your use case. Please see the CIS Kubernetes Benchmark for suggestions on configuring this for your usecase.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-kubernetes-policies">5 Kubernetes Policies<a class="hash-link" href="#5-kubernetes-policies" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-rbac-and-service-accounts">5.1 RBAC and Service Accounts<a class="hash-link" href="#51-rbac-and-service-accounts" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="511">5.1.1<a class="hash-link" href="#511" title="Direct link to heading">​</a></h4><p>Ensure that the cluster-admin role is only used where required (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes provides a set of default roles where RBAC is used. Some of these roles such as `cluster-admin` provide wide-ranging privileges which should only be applied where absolutely necessary. Roles such as `cluster-admin` allow super-user access to perform any action on any resource. When used in a `ClusterRoleBinding`, it gives full control over every resource in the cluster and in all namespaces. When used in a `RoleBinding`, it gives full control over every resource in the rolebinding&#x27;s namespace, including the namespace itself.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Remediation:</strong>
RKE2 does not make inappropriate use of the cluster-admin role. Operators must audit their workloads of additional usage. See the CIS Benchmark guide for more details.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="512">5.1.2<a class="hash-link" href="#512" title="Direct link to heading">​</a></h4><p>Minimize access to secrets (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Inappropriate access to secrets stored within the Kubernetes cluster can allow for an attacker to gain additional access to the Kubernetes cluster or external resources whose credentials are stored as secrets.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
RKE2 limits its use of secrets for the system components appropriately, but operators must audit the use of secrets by their workloads. See the CIS Benchmark guide for more details.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="513">5.1.3<a class="hash-link" href="#513" title="Direct link to heading">​</a></h4><p>Minimize wildcard use in Roles and ClusterRoles (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The principle of least privilege recommends that users are provided only the access required for their role and nothing more. The use of wildcard rights grants is likely to provide excessive rights to the Kubernetes API.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Retrieve the roles defined across each namespaces in the cluster and review for wildcards</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/lib/rancher/rke2/bin/kubectl get roles --all-namespaces -o yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Retrieve the cluster roles defined in the cluster and review for wildcards</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/lib/rancher/rke2/bin/kubectl get clusterroles -o yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that there are not wildcards in use.</p><p><strong>Remediation:</strong>
Operators should review their workloads for proper role usage. See the CIS Benchmark guide for more details.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="514">5.1.4<a class="hash-link" href="#514" title="Direct link to heading">​</a></h4><p>Minimize access to create pods (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The ability to create pods in a cluster opens up possibilities for privilege escalation and should be restricted, where possible.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
Operators should review who has access to create pods in their cluster. See the CIS Benchmark guide for more details.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="515">5.1.5<a class="hash-link" href="#515" title="Direct link to heading">​</a></h4><p>Ensure that default service accounts are not actively used. (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes provides a default service account which is used by cluster workloads where no specific service account is assigned to the pod.<p>Where access to the Kubernetes API from a pod is required, a specific service account should be created for that pod, and rights granted to that service account.</p><p>The default service account should be configured such that it does not provide a service account token and does not have any explicit rights assignments.</p></div></div></details><p><strong>Result:</strong> Pass.</p><p><strong>Audit:</strong>
For	each namespace in the cluster, review the rights assigned to the default service account and ensure that it has no roles or cluster roles bound to it apart from the defaults. Additionally ensure that the automountServiceAccountToken: false setting is in place for each default service account.</p><p><strong>Remediation:</strong>
Create explicit service accounts wherever a Kubernetes workload requires specific access
to the Kubernetes API server.
Modify the configuration of each default service account to include this value</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">automountServiceAccountToken: </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="516">5.1.6<a class="hash-link" href="#516" title="Direct link to heading">​</a></h4><p>Ensure that Service Account Tokens are only mounted where necessary (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Mounting service account tokens inside pods can provide an avenue for privilege escalation attacks where an attacker is able to compromise a single pod in the cluster.<p>Avoiding mounting these tokens removes this attack avenue.</p></div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
The pods launched by RKE2 are part of the control plane and generally need access to communicate with the API server, thus this control does not apply to them. Operators should review their workloads and take steps to modify the definition of pods and service accounts which do not need to mount service account tokens to disable it.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="517">5.1.7<a class="hash-link" href="#517" title="Direct link to heading">​</a></h4><p>Avoid use of system:masters group (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The system:masters group has unrestricted access to the Kubernetes API hard-coded into the API server source code. An authenticated user who is a member of this group cannot have their access reduced, even if all bindings and cluster role bindings which mention it, are removed.<p>When combined with client certificate authentication, use of this group can allow for irrevocable cluster-admin level credentials to exist for a cluster.</p></div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
Remove the system:masters group from all users in the cluster.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="517-1">5.1.7<a class="hash-link" href="#517-1" title="Direct link to heading">​</a></h4><p>Limit use of the Bind, Impersonate and Escalate permissions in the Kubernetes cluster (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">The impersonate privilege allows a subject to impersonate other users gaining their rights to the cluster. The bind privilege allows the subject to add a binding to a cluster role or role which escalates their effective permissions in the cluster. The escalate privilege allows a subject to modify cluster roles to which they are bound, increasing their rights to that level.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
Where possible, remove the impersonate, bind and escalate rights from subjects.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-pod-security-standards">5.2 Pod Security Standards<a class="hash-link" href="#52-pod-security-standards" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="521">5.2.1<a class="hash-link" href="#521" title="Direct link to heading">​</a></h4><p>Ensure that the cluster has at least one active policy control mechanism in place (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Without an active policy control mechanism, it is not possible to limit the use of containers with access to underlying cluster nodes, via mechanisms like privileged containers, or the use of hostPath volume mounts.</div></div></details><p><strong>Result:</strong> Manual - Operator Dependent</p><p><strong>Remediation:</strong>
PSA is enabled since v1.23 by default in RKE2, no remediation necessary.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="522">5.2.2<a class="hash-link" href="#522" title="Direct link to heading">​</a></h4><p>Minimize the admission of privileged containers (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">A container running in the host&#x27;s PID namespace can inspect processes running outside the container. If the container also has access to ptrace capabilities this can be used to escalate privileges outside of the container.<p>There should be at least one PodSecurityPolicy (PSP) defined which does not permit containers to share the host PID namespace.</p><p>If you need to run containers which require hostPID, this should be defined in a separate PSP and you should carefully check RBAC controls to ensure that only limited service accounts and users are given permission to access that PSP.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node to ensure restricted level is enabled in the config file.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">config_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ps</span><span class="token variable" style="color:rgb(191, 199, 213)"> aux </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> kube-apiserver </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)">  </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> -- --admission-control-config-file </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sed</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;s%.*admission-control-config-file[= ]\([^ ]*\).*%\1%&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enforce:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${config_file}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the returned value is <code>enforce: restricted</code></p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of privileged containers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="523">5.2.3<a class="hash-link" href="#523" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers wishing to share the host process ID namespace (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">A container running in the host&#x27;s PID namespace can inspect processes running outside the container. If the container also has access to ptrace capabilities this can be used to escalate privileges outside of the container.<p>There should be at least one admission control policy defined which does not permit containers to share the host PID namespace.</p><p>If you need to run containers which require hostPID, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">config_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ps</span><span class="token variable" style="color:rgb(191, 199, 213)"> aux </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> kube-apiserver </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)">  </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> -- --admission-control-config-file </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sed</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;s%.*admission-control-config-file[= ]\([^ ]*\).*%\1%&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enforce:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${config_file}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the returned value is <code>enforce: restricted</code></p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of privileged containers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="524">5.2.4<a class="hash-link" href="#524" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers wishing to share the host IPC namespace (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">A container running in the host&#x27;s IPC namespace can use IPC to interact with processes outside the container.<p>There should be at least one admission control policy defined which does not permit containers to share the host IPC namespace.</p><p>If you need to run containers which require hostIPC, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">config_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ps</span><span class="token variable" style="color:rgb(191, 199, 213)"> aux </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> kube-apiserver </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)">  </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> -- --admission-control-config-file </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sed</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;s%.*admission-control-config-file[= ]\([^ ]*\).*%\1%&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enforce:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${config_file}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the returned value is <code>enforce: restricted</code></p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of privileged containers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="525">5.2.5<a class="hash-link" href="#525" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers wishing to share the host network namespace (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">A container running in the host&#x27;s network namespace could access the local loopback device, and could access network traffic to and from other pods.<p>There should be at least one admission control policy defined which does not permit containers to share the host network namespace.</p><p>If you need to run containers which require access to the host&#x27;s network namespaces, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">config_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ps</span><span class="token variable" style="color:rgb(191, 199, 213)"> aux </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> kube-apiserver </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)">  </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> -- --admission-control-config-file </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sed</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;s%.*admission-control-config-file[= ]\([^ ]*\).*%\1%&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enforce:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${config_file}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the returned value is <code>enforce: restricted</code></p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of hostNetwork containers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="526">5.2.6<a class="hash-link" href="#526" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers with <code>allowPrivilegeEscalation</code> (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">A container running with the allowPrivilegeEscalation flag set to true may have processes that can gain more privileges than their parent.<p>There should be at least one admission control policy defined which does not permit containers to allow privilege escalation. The option exists (and is defaulted to true) to permit setuid binaries to run.</p><p>If you have need to run containers which use setuid binaries or require privilege escalation, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">config_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ps</span><span class="token variable" style="color:rgb(191, 199, 213)"> aux </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> kube-apiserver </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)">  </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> -- --admission-control-config-file </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sed</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;s%.*admission-control-config-file[= ]\([^ ]*\).*%\1%&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enforce:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${config_file}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the returned value is <code>enforce: restricted</code></p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of containers with .spec.allowPrivilegeEscalationset to true.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="527">5.2.7<a class="hash-link" href="#527" title="Direct link to heading">​</a></h4><p>Minimize the admission of root containers (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Containers may run as any Linux user. Containers which run as the root user, whilst constrained by Container Runtime security features still have a escalated likelihood of container breakout.<p>Ideally, all containers should run as a defined non-UID 0 user.</p><p>There should be at least one admission control policy defined which does not permit root containers.</p><p>If you need to run root containers, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">config_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ps</span><span class="token variable" style="color:rgb(191, 199, 213)"> aux </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> kube-apiserver </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)">  </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> -- --admission-control-config-file </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sed</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;s%.*admission-control-config-file[= ]\([^ ]*\).*%\1%&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enforce:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${config_file}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the returned value is <code>enforce: restricted</code></p><p><strong>Remediation:</strong>
Create a policy for each namespace in the cluster, ensuring that either <code>MustRunAsNonRoot</code> or <code>MustRunAs</code> with the range of UIDs not including 0, is set.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="528">5.2.8<a class="hash-link" href="#528" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers with the NET_RAW capability (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Containers run with a default set of capabilities as assigned by the Container Runtime. By default this can include potentially dangerous capabilities. With Docker as the container runtime the NET_RAW capability is enabled which may be misused by malicious containers.<p>Ideally, all containers should drop this capability.</p><p>There should be at least one admission control policy defined which does not permit containers with the NET_RAW capability.</p><p>If you need to run containers with this capability, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">config_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ps</span><span class="token variable" style="color:rgb(191, 199, 213)"> aux </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> kube-apiserver </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)">  </span><span class="token variable function" style="color:rgb(130, 170, 255)">grep</span><span class="token variable" style="color:rgb(191, 199, 213)"> -- --admission-control-config-file </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sed</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;s%.*admission-control-config-file[= ]\([^ ]*\).*%\1%&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enforce:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${config_file}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the returned value is <code>enforce: restricted</code>.</p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of containers with the <code>NET_RAW</code> capability.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="529">5.2.9<a class="hash-link" href="#529" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers with added capabilities (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Containers run with a default set of capabilities as assigned by the Container Runtime. Capabilities outside this set can be added to containers which could expose them to risks of container breakout attacks.<p>There should be at least one policy defined which prevents containers with capabilities beyond the default set from launching.</p><p>If you need to run containers with additional capabilities, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Remediation:</strong>
Ensure that <code>allowedCapabilities</code> is not present in policies for the cluster unless it is set to an empty array.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5210">5.2.10<a class="hash-link" href="#5210" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers with capabilities assigned (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Containers run with a default set of capabilities as assigned by the Container Runtime. Capabilities are parts of the rights generally granted on a Linux system to the root user.<p>In many cases applications running in containers do not require any capabilities to operate, so from the perspective of the principal of least privilege use of capabilities should be minimized.</p></div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Remediation:</strong>
Review the use of capabilities in applications running on your cluster. Where a namespace contains applicaions which do not require any Linux capabities to operate consider adding a PSP which forbids the admission of containers which do not drop all capabilities.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5211">5.2.11<a class="hash-link" href="#5211" title="Direct link to heading">​</a></h4><p>Minimize the admission of Windows HostProcess containers (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Containers run with a default set of capabilities as assigned by the Container Runtime. Capabilities are parts of the rights generally granted on a Linux system to the root user.<p>In many cases applications running in containers do not require any capabilities to operate, so from the perspective of the principal of least privilege use of capabilities should be minimized.</p></div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of containers that have <code>.securityContext.windowsOptions.hostProcess</code> set to <code>true</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5212">5.2.12<a class="hash-link" href="#5212" title="Direct link to heading">​</a></h4><p>Minimize the admission of HostPath volumes (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">A container which mounts a hostPath volume as part of its specification will have access to the filesystem of the underlying cluster node. The use of hostPath volumes may allow containers access to privileged areas of the node filesystem.<p>There should be at least one admission control policy defined which does not permit containers to mount hostPath volumes.</p><p>If you need to run containers which require hostPath volumes, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of containers with <code>hostPath</code> volumes.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5213">5.2.13<a class="hash-link" href="#5213" title="Direct link to heading">​</a></h4><p>Minimize the admission of containers which use HostPorts (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Host ports connect containers directly to the host&#x27;s network. This can bypass controls such as network policy.<p>There should be at least one admission control policy defined which does not permit containers which require the use of HostPorts.</p><p>If you need to run containers which require HostPorts, this should be defined in a separate policy and you should carefully check to ensure that only limited service accounts and users are given permission to use that policy.</p></div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the admission of containers which use <code>hostPort</code> sections.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-network-policies-and-cni">5.3 Network Policies and CNI<a class="hash-link" href="#53-network-policies-and-cni" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="531">5.3.1<a class="hash-link" href="#531" title="Direct link to heading">​</a></h4><p>Ensure that the CNI in use supports Network Policies (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes network policies are enforced by the CNI plugin in use. As such it is important to ensure that the CNI plugin supports both Ingress and Egress network policies.</div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Review the documentation of CNI plugin in use by the cluster, and confirm that it supports Ingress and Egress network policies.</p><p><strong>Remediation:</strong>
By default, RKE2 use Canal (Calico and Flannel) and fully supports network policies.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="532">5.3.2<a class="hash-link" href="#532" title="Direct link to heading">​</a></h4><p>Ensure that all Namespaces have Network Policies defined (Automated)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Running different applications on the same Kubernetes cluster creates a risk of one compromised application attacking a neighboring application. Network segmentation is important to ensure that containers can communicate only with those they are supposed to. A network policy is a specification of how selections of pods are allowed to communicate with each other and other network endpoints.<p>Network Policies are namespace scoped. When a network policy is introduced to a given namespace, all traffic not allowed by the policy is denied. However, if there are no network policies in a namespace all traffic will be allowed into and out of the pods in that namespace.</p></div></div></details><p><strong>Result:</strong> Pass</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:rgb(191, 199, 213)">i</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> kube-system kube-public default</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /var/lib/rancher/rke2/bin/kubectl get networkpolicies -n </span><span class="token variable" style="color:rgb(191, 199, 213)">$i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that there are network policies applied to each of the namespaces.</p><p><strong>Remediation:</strong>
RKE2, when executed with the <code>--profile=cis-1.23</code> argument applies a secure network policy that only allows intra-namespace traffic and DNS to kube-system. No manual remediation needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-secrets-management">5.4 Secrets Management<a class="hash-link" href="#54-secrets-management" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="541">5.4.1<a class="hash-link" href="#541" title="Direct link to heading">​</a></h4><p>Prefer using secrets as files over secrets as environment variables (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">It is reasonably common for application code to log out its environment (particularly in the event of an error). This will include any secret values passed in as environment variables, so secrets can easily be exposed to any user or entity who has access to the logs.</div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Audit:</strong>
Run the following command to find references to objects which use environment variables defined from secrets.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/lib/rancher/rke2/bin/kubectl get all -o </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">jsonpath</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{range .items[?(@..secretKeyRef)]} {.kind} {.metadata.name} {&quot;\n&quot;}{end}&#x27;</span><span class="token plain"> -A</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
If possible, rewrite application code to read secrets from mounted secret files, rather than from environment variables.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="542">5.4.2<a class="hash-link" href="#542" title="Direct link to heading">​</a></h4><p>Consider external secret storage (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes supports secrets as first-class objects, but care needs to be taken to ensure that access to secrets is carefully limited. Using an external secrets provider can ease the management of access to secrets, especially where secrests are used across both Kubernetes and non-Kubernetes environments.</div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Audit:</strong>
Review your secrets management implementation.</p><p><strong>Remediation:</strong>
Refer to the secrets management options offered by your cloud provider or a third-party secrets management solution.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="55-extensible-admission-control">5.5 Extensible Admission Control<a class="hash-link" href="#55-extensible-admission-control" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="551">5.5.1<a class="hash-link" href="#551" title="Direct link to heading">​</a></h4><p>Configure Image Provenance using ImagePolicyWebhook admission controller (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Kubernetes supports plugging in provenance rules to accept or reject the images in your deployments. You could configure such rules to ensure that only approved images are deployed in the cluster.</div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Audit:</strong>
Review the pod definitions in your cluster and verify that image provenance is configured as appropriate.</p><p><strong>Remediation:</strong>
Follow the Kubernetes documentation and setup image provenance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="56-omitted">5.6 Omitted<a class="hash-link" href="#56-omitted" title="Direct link to heading">​</a></h3><p>The v1.23 guide skips 5.6 and goes from 5.5 to 5.7. We are including it here merely for explanation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="57-general-policies">5.7 General Policies<a class="hash-link" href="#57-general-policies" title="Direct link to heading">​</a></h3><p>These policies relate to general cluster management topics, like namespace best practices and policies applied to pod objects in the cluster.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="571">5.7.1<a class="hash-link" href="#571" title="Direct link to heading">​</a></h4><p>Create administrative boundaries between resources using namespaces (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Limiting the scope of user permissions can reduce the impact of mistakes or malicious activities. A Kubernetes namespace allows you to partition created resources into logically named groups. Resources created in one namespace can be hidden from other namespaces. By default, each resource created by a user in Kubernetes cluster runs in a default namespace, called default. You can create additional namespaces and attach resources and users to them. You can use Kubernetes Authorization plugins to create policies that segregate access to namespace resources between different users.</div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Audit:</strong>
Run the below command and review the namespaces created in the cluster.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/lib/rancher/rke2/bin/kubectl get namespaces</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensure that these namespaces are the ones you need and are adequately administered as per your requirements.</p><p><strong>Remediation:</strong>
Follow the documentation and create namespaces for objects in your deployment as you need them.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="572">5.7.2<a class="hash-link" href="#572" title="Direct link to heading">​</a></h4><p>Ensure that the seccomp profile is set to <code>docker/default</code> in your pod definitions (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Seccomp (secure computing mode) is used to restrict the set of system calls applications can make, allowing cluster administrators greater control over the security of workloads running in the cluster. Kubernetes disables seccomp profiles by default for historical reasons. You should enable it to ensure that the workloads have restricted actions available within the container.</div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Audit:</strong>
Review the pod definitions in your cluster. It should create a line as below:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">seccomp.security.alpha.kubernetes.io/pod</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> docker/default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Remediation:</strong>
Review the Kubernetes documentation and if needed, apply a relevant PodSecurityPolicy.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="573">5.7.3<a class="hash-link" href="#573" title="Direct link to heading">​</a></h4><p>Apply Security Context to Your Pods and Containers (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">A security context defines the operating system security settings (uid, gid, capabilities, SELinux role, etc..) applied to a container. When designing your containers and pods, make sure that you configure the security context for your pods, containers, and volumes. A security context is a property defined in the deployment yaml. It controls the security parameters that will be assigned to the pod/container/volume. There are two levels of security context: pod level security context, and container level security context.</div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Audit:</strong>
Review the pod definitions in your cluster and verify that you have security contexts defined as appropriate.</p><p><strong>Remediation:</strong>
Follow the Kubernetes documentation and apply security contexts to your pods. For a suggested list of security contexts, you may refer to the CIS Security Benchmark.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="574">5.7.4<a class="hash-link" href="#574" title="Direct link to heading">​</a></h4><p>The default namespace should not be used (Manual)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Rationale</summary><div><div class="collapsibleContent_i85q">Resources in a Kubernetes cluster should be segregated by namespace, to allow for security controls to be applied at that level and to make it easier to manage resources.</div></div></details><p><strong>Result:</strong> Manual</p><p><strong>Audit:</strong>
Run the below command on the master node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/lib/rancher/rke2/bin/kubectl get all -n default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that there are no resources applied to the default namespace.</p><p><strong>Remediation:</strong>
By default, RKE2 does not utilize the default namespace.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rke2-docs/edit/main/docs/security/cis_self_assessment123.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-11-22T22:25:23.000Z">11/22/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/security/cis_self_assessment16"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CIS 1.6 Self-Assessment Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/security/fips_support"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FIPS 140-2 Enablement</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cis-kubernetes-benchmark-v123---rke2" class="table-of-contents__link toc-highlight">CIS Kubernetes Benchmark v1.23 - RKE2</a></li><li><a href="#controls" class="table-of-contents__link toc-highlight">Controls</a></li><li><a href="#1-master-node-security-configuration" class="table-of-contents__link toc-highlight">1 Master Node Security Configuration</a><ul><li><a href="#11-master-node-configuration-files" class="table-of-contents__link toc-highlight">1.1 Master Node Configuration Files</a></li><li><a href="#12-api-server" class="table-of-contents__link toc-highlight">1.2 API Server</a></li><li><a href="#13-controller-manager" class="table-of-contents__link toc-highlight">1.3 Controller Manager</a></li><li><a href="#14-scheduler" class="table-of-contents__link toc-highlight">1.4 Scheduler</a></li></ul></li><li><a href="#2-etcd-node-configuration" class="table-of-contents__link toc-highlight">2 Etcd Node Configuration</a></li><li><a href="#3-control-plane-configuration" class="table-of-contents__link toc-highlight">3 Control Plane Configuration</a><ul><li><a href="#31-authentication-and-authorization" class="table-of-contents__link toc-highlight">3.1 Authentication and Authorization</a></li><li><a href="#32-logging" class="table-of-contents__link toc-highlight">3.2 Logging</a></li></ul></li><li><a href="#4-worker-node-security-configuration" class="table-of-contents__link toc-highlight">4 Worker Node Security Configuration</a><ul><li><a href="#41-worker-node-configuration-files" class="table-of-contents__link toc-highlight">4.1 Worker Node Configuration Files</a></li><li><a href="#42-kubelet" class="table-of-contents__link toc-highlight">4.2 Kubelet</a></li></ul></li><li><a href="#5-kubernetes-policies" class="table-of-contents__link toc-highlight">5 Kubernetes Policies</a><ul><li><a href="#51-rbac-and-service-accounts" class="table-of-contents__link toc-highlight">5.1 RBAC and Service Accounts</a></li><li><a href="#52-pod-security-standards" class="table-of-contents__link toc-highlight">5.2 Pod Security Standards</a></li><li><a href="#53-network-policies-and-cni" class="table-of-contents__link toc-highlight">5.3 Network Policies and CNI</a></li><li><a href="#54-secrets-management" class="table-of-contents__link toc-highlight">5.4 Secrets Management</a></li><li><a href="#55-extensible-admission-control" class="table-of-contents__link toc-highlight">5.5 Extensible Admission Control</a></li><li><a href="#56-omitted" class="table-of-contents__link toc-highlight">5.6 Omitted</a></li><li><a href="#57-general-policies" class="table-of-contents__link toc-highlight">5.7 General Policies</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a04d5984.js"></script>
<script src="/assets/js/main.f0033ba0.js"></script>
</body>
</html>